{% extends "base.html" %}

{% block title %}Forgot Password{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/premium-auth.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

{% endblock %}

{% block content %}
<div class="auth-container">
    <!-- Left Side - Branding -->
    <div class="auth-branding">
        <div class="branding-content">
            <div class="brand-logo">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                    <defs>
                        <linearGradient id="gradient1" x1="2" y1="2" x2="22" y2="12">
                            <stop offset="0%" stop-color="#667eea"/>
                            <stop offset="100%" stop-color="#764ba2"/>
                        </linearGradient>
                        <linearGradient id="gradient2" x1="2" y1="7" x2="22" y2="22">
                            <stop offset="0%" stop-color="#f093fb"/>
                            <stop offset="100%" stop-color="#f5576c"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h1 class="brand-title">Reset Your<br><span class="highlight">Password</span></h1>
            <p class="brand-description">Don't worry! It happens to the best of us. Enter your email and username to receive a reset code.</p>
            
            <div class="info-cards">
                <div class="info-card">
                    <div class="info-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                    </div>
                    <div>
                        <h4>Email Verification</h4>
                        <p>We'll send a 6-digit code to your registered email</p>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                    </div>
                    <div>
                        <h4>Secure Process</h4>
                        <p>Your account security is our top priority</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="decorative-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
        </div>
    </div>

    <!-- Right Side - Form -->
    <div class="auth-form-section">
        <div class="form-container wide-form">
            <div class="form-header">
                <div class="header-icon">
                    <svg width="56" height="56" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="url(#iconGradient)" stroke-width="2"/>
                        <path d="M12 8v4M12 16h.01" stroke="url(#iconGradient)" stroke-width="2" stroke-linecap="round"/>
                        <defs>
                            <linearGradient id="iconGradient" x1="2" y1="2" x2="22" y2="22">
                                <stop offset="0%" stop-color="#667eea"/>
                                <stop offset="100%" stop-color="#764ba2"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h2>Forgot Password?</h2>
                <p>Enter your email and username to receive a reset code</p>
            </div>

            {% if error %}
                <div class="alert alert-error">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    {{ error }}
                </div>
            {% endif %}

            {% if success %}
                <div class="alert alert-success">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    {{ success }}
                </div>
            {% endif %}

            <form method="POST" class="auth-form" id="forgotPasswordForm">
                <div class="form-group">
                    <label for="email">Email Address <span class="required">*</span></label>
                    <div class="input-container">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="4" width="20" height="16" rx="2"/>
                            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                        </svg>
                        <input type="email" id="email" name="email" placeholder="Enter your registered email" required autocomplete="email">
                    </div>
                    <small class="help-text">Enter the email address associated with your account</small>
                </div>

                <div class="form-group">
                    <label for="username">Username <span class="required">*</span></label>
                    <div class="input-container">
                        <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <input type="text" id="username" name="username" value="{{ username }}" placeholder="Enter your username" required autocomplete="username">
                    </div>
                    <small class="help-text">Your account username for verification</small>
                </div>

                <button type="submit" class="btn-primary">
                    <span>Send Reset Code</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12 5 19 12 12 19"/>
                    </svg>
                </button>
            </form>

            <div class="divider">
                <span>OR</span>
            </div>

            <div class="action-links">
                <a href="{{ url_for('auth.login') }}" class="link-with-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12 19 5 12 12 5"/>
                    </svg>
                    <span>Back to Login</span>
                </a>
                <a href="{{ url_for('auth.register') }}" class="link-with-icon">
                    <span>Create New Account</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12 5 19 12 12 19"/>
                    </svg>
                </a>
            </div>

            <div class="security-note">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                <p>Your security is important to us. The reset code will expire in 15 minutes.</p>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal" id="loadingModal">
    <div class="modal-content loading-modal">
        <div class="loading-spinner">
            <div class="spinner"></div>
        </div>
        <h3>Sending Reset Code...</h3>
        <p>Please wait while we send the verification code to your email.</p>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
    const email = document.getElementById('email').value.trim();
    const username = document.getElementById('username').value.trim();
    
    if (!email || !username) {
        e.preventDefault();
        showAlert('Please fill in all fields', 'error');
        return;
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        e.preventDefault();
        showAlert('Please enter a valid email address', 'error');
        return;
    }
    
    // Show loading modal
    document.getElementById('loadingModal').classList.add('active');
});

function showAlert(message, type) {
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        ${message}
    `;
    
    const formHeader = document.querySelector('.form-header');
    formHeader.after(alert);
    
    setTimeout(() => alert.remove(), 5000);
}
</script>
{% endblock %}